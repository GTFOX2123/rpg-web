<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>RPG com Salvamento Local</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      background: #121212 url('https://i.imgur.com/zQZRW5E.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      margin: 0; padding: 0;
    }
    .container {
      margin-top: 40px;
      background-color: rgba(0, 0, 0, 0.75);
      padding: 30px;
      border-radius: 15px;
      display: inline-block;
      box-shadow: 0 0 20px rgba(0,0,0,0.9);
      width: 360px;
    }
    .status {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-bottom: 20px;
    }
    .character {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .bar {
      width: 140px;
      height: 18px;
      background: #444;
      border: 1px solid #999;
      margin: 6px 0;
      border-radius: 6px;
      overflow: hidden;
    }
    .bar-inner {
      height: 100%;
      background: limegreen;
      width: 100%;
      transition: width 0.4s ease;
      border-radius: 6px 0 0 6px;
    }
    .bar-inner.hp {
      background: #e74c3c;
    }
    .bar-inner.xp {
      background: #3498db;
    }
    img.sprite {
      image-rendering: pixelated;
      width: 96px;
      height: 96px;
      margin-bottom: 10px;
      transition: transform 0.3s;
    }
    button {
      padding: 10px 18px;
      margin: 6px 8px 12px 8px;
      font-size: 14px;
      cursor: pointer;
      background: #2980b9;
      border: none;
      border-radius: 8px;
      color: white;
      transition: background 0.3s;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background: #3498db;
    }
    button:disabled {
      background: #555;
      cursor: default;
    }
    #log {
      min-height: 60px;
      margin: 12px 0;
      font-weight: bold;
      font-size: 16px;
      height: 60px;
    }
    .inventory {
      background: rgba(255,255,255,0.12);
      padding: 10px;
      border-radius: 10px;
      max-width: 340px;
      margin: 0 auto;
      text-align: left;
    }
    .inventory h3 {
      margin-top: 0;
    }
    .inventory ul {
      padding-left: 20px;
    }
    .inventory li {
      cursor: pointer;
      user-select: none;
      margin-bottom: 6px;
      transition: background-color 0.25s;
      padding: 2px 6px;
      border-radius: 5px;
    }
    .inventory li:hover {
      background-color: rgba(255, 255, 255, 0.25);
    }
    @keyframes attack-move {
      0% { transform: translateX(0); }
      50% { transform: translateX(15px); }
      100% { transform: translateX(0); }
    }
    @keyframes hurt-shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-10px); }
      40%, 80% { transform: translateX(10px); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RPG com Salvamento Local</h1>
    <div class="status">
      <div class="character">
        <img id="hero" class="sprite" src="https://i.imgur.com/NbP1N3D.png" alt="Herói" />
        <div class="bar" title="HP">
          <div id="playerHPBar" class="bar-inner hp"></div>
        </div>
        <p>HP: <span id="playerHP">100</span> / 100</p>
        <div class="bar" title="XP">
          <div id="playerXPBar" class="bar-inner xp"></div>
        </div>
        <p>Nível: <span id="playerLevel">1</span></p>
        <p>MP: <span id="playerMP">50</span> / 50</p>
      </div>

      <div class="character">
        <img id="enemy" class="sprite" src="https://i.imgur.com/3KXQZ92.png" alt="Inimigo" />
        <div class="bar" title="HP">
          <div id="enemyHPBar" class="bar-inner hp"></div>
        </div>
        <p>HP: <span id="enemyHP">100</span> / 100</p>
        <p>Inimigo Nível: <span id="enemyLevel">1</span></p>
      </div>
    </div>

    <div id="actions">
      <button onclick="attack()" id="attackBtn">Ataque Normal</button>
      <button onclick="specialAttack()" id="specialBtn">Ataque Especial (20 de MP)</button>
      <button onclick="heal()" id="healBtn">Curar (20 de MP)</button>
      <button onclick="resetGame()" style="background:#c0392b; margin-top:10px;">Reiniciar Jogo</button>
    </div>

    <p id="log"></p>

    <div class="inventory">
      <h3>Inventário (clique para usar poção)</h3>
      <ul id="inventoryList"></ul>
    </div>

    <audio id="attackSound" src="https://freesound.org/data/previews/341/341695_6247570-lq.mp3"></audio>
    <audio id="healSound" src="https://freesound.org/data/previews/146/146721_2615116-lq.mp3"></audio>
    <audio id="winSound" src="https://freesound.org/data/previews/170/170410_2437358-lq.mp3"></audio>
    <audio id="loseSound" src="https://freesound.org/data/previews/198/198841_2859978-lq.mp3"></audio>
  </div>

  <script>
    let player = {
      maxHP: 100,
      hp: 100,
      maxMP: 50,
      mp: 50,
      level: 1,
      xp: 0,
      xpToNext: 100,
      attackMin: 10,
      attackMax: 20,
      specialCost: 20,
      healCost: 20
    };

    let enemy = {
      maxHP: 100,
      hp: 100,
      level: 1,
      attackMin: 8,
      attackMax: 18
    };

    let inventory = {
      potions: 3
    };

    const attackSound = document.getElementById('attackSound');
    const healSound = document.getElementById('healSound');
    const winSound = document.getElementById('winSound');
    const loseSound = document.getElementById('loseSound');

    const heroSprite = document.getElementById('hero');
    const enemySprite = document.getElementById('enemy');

    const attackBtn = document.getElementById('attackBtn');
    const specialBtn = document.getElementById('specialBtn');
    const healBtn = document.getElementById('healBtn');
    const inventoryList = document.getElementById('inventoryList');

    const logEl = document.getElementById('log');

    // Salva dados no localStorage
    function saveGame() {
      const data = {
        player, enemy, inventory
      };
      localStorage.setItem('rpgSave', JSON.stringify(data));
    }

    // Carrega dados do localStorage se existirem
    function loadGame() {
      const data = localStorage.getItem('rpgSave');
      if (data) {
        const parsed = JSON.parse(data);
        player = parsed.player;
        enemy = parsed.enemy;
        inventory = parsed.inventory;
        log('Jogo carregado do salvamento!');
      } else {
        log('Novo jogo iniciado. Sua vez!');
      }
      updateStatus();
      updateInventory();
      disableButtons(false);
    }

    // Atualiza as barras e textos do status
    function updateStatus() {
      document.getElementById('playerHP').textContent = player.hp;
      document.getElementById('playerLevel').textContent = player.level;
      document.getElementById('playerHPBar').style.width = (player.hp / player.maxHP * 100) + '%';
      document.getElementById('playerXPBar').style.width = (player.xp / player.xpToNext * 100) + '%';
      document.getElementById('playerMP').textContent = player.mp;

      document.getElementById('enemyHP').textContent = enemy.hp;
      document.getElementById('enemyHPBar').style.width = (enemy.hp / enemy.maxHP * 100) + '%';
      document.getElementById('enemyLevel').textContent = enemy.level;

      specialBtn.disabled = player.mp < player.specialCost;
      healBtn.disabled = player.mp < player.healCost;
    }

    // Atualiza inventário visual
    function updateInventory() {
      inventoryList.innerHTML = '';
      if(inventory.potions > 0) {
        const li = document.createElement('li');
        li.textContent = `Poção de Vida (x${inventory.potions})`;
        li.onclick = () => {
          usePotion();
          saveGame();
        };
        inventoryList.appendChild(li);
      } else {
        const li = document.createElement('li');
        li.textContent = 'Sem poções';
        inventoryList.appendChild(li);
      }
    }

    function log(msg) {
      logEl.textContent = msg;
    }

    // Jogador ataca inimigo
    function attack() {
      disableButtons(true);
      let damage = random(player.attackMin, player.attackMax);
      playSound(attackSound);
      animateAttack(heroSprite, enemySprite);

      enemy.hp = Math.max(0, enemy.hp - damage);
      log(`Você atacou e causou ${damage} de dano!`);

      updateStatus();
      saveGame();

      setTimeout(() => {
        if(enemy.hp <= 0) {
          playerWin();
        } else {
          enemyTurn();
        }
      }, 900);
    }

    // Ataque especial
    function specialAttack() {
      if(player.mp < player.specialCost) {
        log('MP insuficiente para ataque especial!');
        return;
      }
      disableButtons(true);
      player.mp -= player.specialCost;
      let damage = random(player.attackMax + 10, player.attackMax + 20);
      playSound(attackSound);
      animateAttack(heroSprite, enemySprite, true);

      enemy.hp = Math.max(0, enemy.hp - damage);
      log(`Ataque especial! Você causou ${damage} de dano!`);

      updateStatus();
      saveGame();

      setTimeout(() => {
        if(enemy.hp <= 0) {
          playerWin();
        } else {
          enemyTurn();
        }
      }, 1100);
    }

    // Curar jogador
    function heal() {
      if(player.mp < player.healCost) {
        log('MP insuficiente para curar!');
        return;
      }
      disableButtons(true);
      player.mp -= player.healCost;
      let healAmount = random(25, 40);
      player.hp = Math.min(player.maxHP, player.hp + healAmount);
      playSound(healSound);
      animateHeal(heroSprite);
      log(`Você se curou em ${healAmount} pontos!`);

      updateStatus();
      saveGame();

      setTimeout(enemyTurn, 1000);
    }

    // Usar poção
    function usePotion() {
      if(inventory.potions <= 0) {
        log('Sem poções para usar!');
        return;
      }
      inventory.potions--;
      let healAmount = 50;
      player.hp = Math.min(player.maxHP, player.hp + healAmount);
      playSound(healSound);
      animateHeal(heroSprite);
      log(`Você usou uma poção e recuperou ${healAmount} HP!`);

      updateInventory();
      updateStatus();
      saveGame();
    }

    // Turno inimigo
    function enemyTurn() {
      let damage = random(enemy.attackMin, enemy.attackMax);
      playSound(attackSound);
      animateAttack(enemySprite, heroSprite);

      player.hp = Math.max(0, player.hp - damage);
